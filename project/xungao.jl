using OMEinsumContractionOrders, OMEinsum
using Random; Random.seed!(2)

dims = Tuple{Int,Int,Bool}[(1, 4, false), (2, 4, false), (3, 4, false), (4, 4, false), (5, 4, false), (6, 4, false), (7, 4, false),
    (8, 4, false), (9, 4, false), (10, 4, false), (11, 4, false), (12, 4, false), (13, 4, false), (14, 4, false),
    (15, 4, false), (16, 4, false), (17, 4, false), (18, 4, false), (19, 4, false), (20, 4, false), (21, 4, false),
    (22, 4, false), (23, 4, false), (24, 4, false), (25, 4, false), (26, 4, false), (27, 4, false), (28, 4, false),
    (29, 4, false), (30, 4, false), (31, 4, false), (32, 4, false), (33, 4, false), (34, 4, false), (35, 4, false),
    (36, 4, false), (37, 4, false), (38, 4, false), (39, 4, false), (40, 4, false), (41, 4, false), (42, 4, false), 
    (43, 4, false), (44, 4, false), (45, 4, false), (46, 4, false), (47, 4, false), (48, 4, false), (49, 4, false), 
    (50, 4, false), (51, 4, false), (52, 4, false), (53, 4, false), (54, 4, false), (55, 4, false), (56, 4, false), 
    (57, 4, false), (58, 4, false), (59, 4, false), (60, 4, false), (61, 4, false), (62, 4, false), (63, 4, false),
    (64, 4, false), (65, 4, false), (66, 4, false), (67, 4, false), (68, 4, false), (69, 4, false), (70, 4, false),
    (71, 4, false), (72, 4, false), (73, 4, false), (74, 4, false), (75, 4, false), (76, 4, false), (77, 4, false),
    (78, 4, false), (79, 4, false), (80, 4, false), (81, 4, false), (82, 4, false), (83, 4, false), (84, 4, false),
    (85, 4, false), (86, 4, false), (87, 4, false), (88, 4, false), (89, 4, false), (90, 4, false), (91, 4, false),
    (92, 4, false), (93, 4, false), (94, 4, false), (95, 4, false), (96, 4, false), (97, 4, false), (98, 4, false),
    (99, 4, false), (100, 4, false), (101, 4, false), (102, 4, false), (103, 4, false), (104, 4, false), (105, 4, false),
    (106, 4, false), (107, 4, false), (108, 4, false), (109, 4, false), (110, 4, false), (111, 4, false), (112, 4, false),
    (113, 4, false), (114, 4, false), (115, 4, false), (116, 4, false), (117, 4, false), (118, 4, false), (119, 4, false),
    (120, 4, false), (121, 4, false), (122, 4, false), (123, 4, false), (124, 4, false), (125, 4, false), (126, 4, false),
    (127, 4, false), (128, 4, false), (129, 4, false), (130, 4, false), (131, 4, false), (132, 4, false), (133, 4, false),
    (134, 4, false), (135, 4, false), (136, 4, false), (137, 4, false), (138, 4, false), (139, 4, false), (140, 4, false),
    (141, 4, false), (142, 4, false), (143, 4, false), (144, 4, false), (145, 4, false), (146, 4, false), (147, 4, false),
    (148, 4, false), (149, 4, false), (150, 4, false), (151, 4, false), (152, 4, false), (153, 4, false), (154, 4, false),
    (155, 4, false), (156, 4, false), (157, 4, false), (158, 4, false), (159, 4, false), (160, 4, false), (161, 4, false),
    (162, 4, false), (163, 4, false), (164, 4, false), (165, 4, false), (166, 4, false), (167, 4, false), (168, 4, false),
    (169, 4, false), (170, 4, false), (171, 4, false), (172, 4, false), (173, 4, false), (174, 4, false), (175, 4, false),
    (176, 4, false), (177, 4, false), (178, 4, false), (179, 4, false), (180, 4, false), (181, 4, false), (182, 4, false),
    (183, 4, false), (184, 4, false), (185, 4, false), (186, 4, false), (187, 4, false), (188, 4, false), (189, 4, false),
    (190, 4, false), (191, 4, false), (192, 4, false), (193, 4, false), (194, 4, false), (195, 4, false), (196, 4, false),
    (197, 4, false), (198, 4, false), (199, 4, false), (200, 4, false), (201, 4, false), (202, 4, false), (203, 4, false),
    (204, 4, false), (205, 4, false), (206, 4, false), (207, 4, false), (208, 4, false), (209, 4, false), (210, 4, false),
    (211, 4, false), (212, 4, false), (213, 4, false), (214, 4, false), (215, 4, false), (216, 4, false), (217, 4, false),
    (218, 4, false), (219, 4, false), (220, 4, false), (221, 4, false), (222, 4, false), (223, 4, false), (224, 4, false),
    (225, 4, false), (226, 4, false), (227, 4, false), (228, 4, false), (229, 4, false), (230, 4, false), (231, 4, false),
    (232, 4, false), (233, 4, false), (234, 4, false), (235, 4, false), (236, 4, false), (237, 4, false), (238, 4, false),
    (239, 4, false), (240, 4, false), (241, 4, false), (242, 4, false), (243, 4, false), (244, 4, false), (245, 4, false),
    (246, 4, false), (247, 4, false), (248, 4, false), (249, 4, false), (250, 4, false), (251, 4, false), (252, 4, false),
    (253, 4, false), (254, 4, false), (255, 4, false), (256, 4, false), (257, 4, false), (258, 4, false), (259, 4, false),
    (260, 4, false), (261, 4, false), (262, 4, false), (263, 4, false), (264, 4, false), (265, 4, false), (266, 4, false),
    (267, 4, false), (268, 4, false), (269, 4, false), (270, 4, false), (271, 4, false), (272, 4, false), (273, 4, false),
    (274, 4, false), (275, 4, false), (276, 4, false), (277, 4, false), (278, 4, false), (279, 4, false), (280, 4, false),
    (281, 4, false), (282, 4, false), (283, 4, false), (284, 4, false), (285, 4, false), (286, 4, false), (287, 4, false),
    (288, 4, false), (289, 4, false), (290, 4, false), (291, 4, false), (292, 4, false), (293, 4, false), (294, 4, false),
    (295, 4, false), (296, 4, false), (297, 4, false), (298, 4, false), (299, 4, false), (300, 4, false), (301, 4, false),
    (302, 4, false), (303, 4, false), (304, 4, false), (305, 4, false), (306, 4, false), (307, 4, false), (308, 4, false),
    (309, 4, false), (310, 4, false), (311, 4, false), (312, 4, false), (313, 4, false), (314, 4, false), (315, 4, false),
    (316, 4, false), (317, 4, false), (318, 4, false), (319, 4, false), (320, 4, false), (321, 4, false), (322, 4, false),
    (323, 4, false), (324, 4, false), (325, 4, false), (326, 4, false), (327, 4, false), (328, 4, false), (329, 4, false),
    (330, 4, false), (331, 4, false), (332, 4, false), (333, 4, false), (334, 4, false), (335, 4, false), (336, 4, false),
    (337, 4, false), (338, 4, false), (339, 4, false), (340, 4, false), (341, 4, false), (342, 4, false), (343, 4, false),
    (344, 4, false), (345, 4, false), (346, 4, false), (347, 4, false), (348, 4, false), (349, 4, false), (350, 4, false),
    (351, 4, false), (352, 4, false), (353, 4, false), (354, 4, false), (355, 4, false), (356, 4, false), (357, 4, false),
    (358, 4, false), (359, 4, false), (360, 4, false), (361, 4, false), (362, 4, false), (363, 4, false), (364, 4, false),
    (365, 4, false), (366, 4, false), (367, 4, false), (368, 4, false), (369, 4, false), (370, 4, false), (371, 4, false),
    (372, 4, false), (373, 4, false), (374, 4, false), (375, 4, false), (376, 4, false), (377, 4, false), (378, 4, false),
    (379, 4, false), (380, 4, false), (381, 4, false), (382, 4, false), (383, 4, false), (384, 4, false), (385, 4, false),
    (386, 4, false), (387, 4, false), (388, 4, false), (389, 4, false), (390, 4, false), (391, 4, false), (392, 4, false),
    (393, 4, false), (394, 4, false), (395, 4, false), (396, 4, false), (397, 4, false), (398, 4, false), (399, 4, false),
    (400, 4, false), (401, 4, false), (402, 4, false), (403, 4, false), (404, 4, false), (405, 4, false), (406, 4, false),
    (407, 4, false), (408, 4, false), (409, 4, false), (410, 4, false), (411, 4, false), (412, 4, false), (413, 4, false),
    (414, 4, false), (415, 4, false), (416, 4, false), (417, 4, false), (418, 4, false), (419, 4, false), (420, 4, false),
    (421, 4, false), (422, 4, false), (423, 4, false), (424, 4, false), (425, 4, false), (426, 4, false), (427, 4, false),
    (428, 4, false), (429, 4, false), (430, 4, false), (431, 4, false), (432, 4, false), (433, 4, false), (434, 4, false),
    (435, 4, false), (436, 4, false), (437, 4, false), (438, 4, false), (439, 4, false), (440, 4, false), (441, 4, false),
    (442, 4, false), (443, 4, false), (444, 4, false), (445, 4, false), (446, 4, false), (447, 4, false), (448, 4, false),
    (449, 4, false), (450, 4, false), (451, 4, false), (452, 4, false), (453, 4, false), (454, 4, false), (455, 4, false),
    (456, 4, false), (457, 4, false), (458, 4, false), (459, 4, false), (460, 4, false), (461, 4, false), (462, 4, false),
    (463, 4, false), (464, 4, false), (465, 4, false), (466, 4, false), (467, 4, false), (468, 4, false), (469, 4, false),
    (470, 4, false), (471, 4, false), (472, 4, false), (473, 4, false), (474, 4, false), (475, 4, false), (476, 4, false),
    (477, 4, false), (478, 4, false), (479, 4, false), (480, 4, false), (481, 4, false), (482, 4, false), (483, 4, false),
    (484, 4, false), (485, 4, false), (486, 4, false), (487, 4, false), (488, 4, false), (489, 4, false), (490, 4, false),
    (491, 4, false), (492, 4, false), (493, 4, false), (494, 4, false), (495, 4, false), (496, 4, false), (497, 4, false),
    (498, 4, false), (499, 4, false), (500, 4, false), (501, 4, false), (502, 4, false), (503, 4, false), (504, 4, false),
    (505, 4, false), (506, 4, false), (507, 4, false), (508, 4, false), (509, 4, false), (510, 4, false), (511, 4, false),
    (512, 4, false), (513, 4, false), (514, 4, false), (515, 4, false), (516, 4, false), (517, 4, false), (518, 4, false),
    (519, 4, false), (520, 4, false), (521, 4, false), (522, 4, false), (523, 4, false), (524, 4, false), (525, 4, false),
    (526, 4, false), (527, 4, false), (528, 4, false), (529, 4, false), (530, 4, false), (531, 4, false), (532, 4, false),
    (533, 4, false), (534, 4, false), (535, 4, false), (536, 4, false), (537, 4, false), (538, 4, false), (539, 4, false),
    (540, 4, false), (541, 4, false), (542, 4, false), (543, 4, false), (544, 4, false), (545, 4, false), (546, 4, false),
    (547, 4, false), (548, 4, false), (549, 4, false), (550, 4, false), (551, 4, false), (552, 4, false), (553, 4, false),
    (554, 4, false), (555, 4, false), (556, 4, false), (557, 4, false), (558, 4, false), (559, 4, false), (560, 4, false),
    (561, 4, false), (562, 4, false), (563, 4, false), (564, 4, false), (565, 4, false), (566, 4, false), (567, 4, false),
    (568, 4, false), (569, 4, false), (570, 4, false), (571, 4, false), (572, 4, false), (573, 4, false), (574, 4, false),
    (575, 4, false), (576, 4, false), (577, 4, false), (578, 4, false), (579, 4, false), (580, 4, false), (581, 4, false),
    (582, 4, false), (583, 4, false), (584, 4, false), (585, 4, false), (586, 4, false), (587, 4, false), (588, 4, false),
    (589, 4, false), (590, 4, false), (591, 4, false), (592, 4, false), (593, 4, false), (594, 4, false), (595, 4, false),
    (596, 4, false), (597, 4, false), (598, 4, false), (599, 4, false), (600, 4, false), (601, 4, false), (602, 4, false),
    (603, 4, false), (604, 4, false), (605, 4, false), (606, 4, false), (607, 4, false), (608, 4, false), (609, 4, false),
    (610, 4, false), (611, 4, false), (612, 4, false), (613, 4, false), (614, 4, false), (615, 4, false), (616, 4, false),
    (617, 4, false), (618, 4, false), (619, 4, false), (620, 4, false), (621, 4, false), (622, 4, false), (623, 4, false),
    (624, 4, false), (625, 4, false), (626, 4, false), (627, 4, false), (628, 4, false), (629, 4, false), (630, 4, false),
    (631, 4, false), (632, 4, false), (633, 4, false), (634, 4, false), (635, 4, false), (636, 4, false), (637, 4, false),
    (638, 4, false), (639, 4, false), (640, 4, false), (641, 4, false), (642, 4, false), (643, 4, false), (644, 4, false),
    (645, 4, false), (646, 4, false), (647, 4, false), (648, 2, true), (649, 2, true), (650, 2, true), (651, 2, true),
    (652, 2, true), (653, 2, true), (654, 2, true), (655, 2, true), (656, 2, true), (657, 2, true), (658, 2, true),
    (659, 2, true), (660, 2, true), (661, 2, true), (662, 2, true), (663, 2, true), (664, 2, true), (665, 2, true),
    (666, 2, true), (667, 2, true), (668, 2, true), (669, 2, true), (670, 2, true)];

edges = [(1, 28), (2, 29), (3, 30), (4, 31), (5, 32), (6, 33), (7, 34), (8, 35), (9, 36), (10, 37), (11, 38), (12, 39),
    (13, 40), (14, 41), (15, 42), (16, 43), (17, 44), (18, 45), (19, 46), (20, 47), (21, 48), (22, 49), (23, 50), (24, 51),
    (25, 52), (26, 53), (27, 54), (28, 55, 29, 56), (30, 57, 35, 62), (31, 58, 36, 63), (32, 59, 33, 60), (34, 61, 40, 67),
    (37, 64, 38, 65), (39, 66, 42, 69), (41, 68, 47, 74), (43, 70, 44, 71), (45, 72), (46, 73), (48, 75, 51, 78),
    (49, 76, 54, 81), (50, 77, 52, 79), (53, 80), (56, 82), (58, 83), (59, 84), (61, 85), (62, 86), (63, 87), (64, 88),
    (65, 89), (66, 90), (67, 91), (68, 92), (69, 93), (70, 94), (71, 95), (72, 96), (73, 97), (74, 98), (75, 99), (76, 100),
    (77, 101), (78, 102), (80, 103), (82, 104, 85, 107), (83, 105, 84, 106), (86, 108, 99, 121), (87, 109, 92, 114),
    (88, 110, 90, 112), (89, 111, 96, 118), (91, 113, 100, 122), (93, 115), (94, 116), (95, 117, 97, 119), (98, 120),
    (101, 123), (102, 124), (103, 125), (105, 126), (107, 127), (109, 128), (110, 129), (111, 130), (112, 131), (113, 132),
    (114, 133), (115, 134), (116, 135), (117, 136), (119, 137), (120, 138), (121, 139), (122, 140), (123, 141), (124, 142),
    (125, 143), (126, 144, 129, 147), (127, 145, 128, 146), (130, 148, 137, 155), (131, 149, 135, 153), (132, 150, 139, 157),
    (133, 151, 134, 152), (136, 154, 143, 161), (138, 156, 140, 158), (141, 159), (142, 160), (146, 162), (147, 163), (149, 164),
    (150, 165), (151, 166), (152, 167), (153, 168), (154, 169), (155, 170), (156, 171), (157, 172), (158, 173), (159, 174),
    (160, 175), (161, 176), (162, 177, 164, 179), (163, 178, 169, 184), (165, 180, 166, 181), (167, 182), (168, 183), (170, 185),
    (171, 186), (172, 187, 174, 189), (173, 188, 175, 190), (176, 191), (179, 193), (180, 194), (181, 195), (182, 196),
    (183, 197), (184, 198), (185, 199), (186, 200), (187, 201), (188, 202), (191, 203), (192, 204, 199, 211), (193, 205, 197, 209),
    (194, 206, 201, 213), (195, 207, 196, 208), (198, 210, 203, 215), (200, 212, 202, 214), (204, 219), (205, 220), (206, 221),
    (207, 222), (208, 223), (209, 224), (210, 225), (211, 226), (212, 227), (215, 228), (216, 229, 219, 232), (217, 230, 220, 233),
    (218, 231, 225, 238), (221, 234, 222, 235), (223, 236), (224, 237), (226, 239), (227, 240), (228, 241), (229, 243), (230, 245),
    (231, 246), (232, 247), (233, 248), (235, 249), (236, 250), (237, 251), (238, 252), (239, 253), (240, 254), (241, 255),
    (242, 256, 245, 259), (243, 257, 244, 258), (246, 260, 247, 261), (248, 262, 250, 264), (249, 263, 254, 268), (251, 265, 252, 266),
    (253, 267), (255, 269), (256, 270), (257, 271), (258, 272), (259, 273), (260, 274), (261, 275), (262, 276), (263, 277), (264, 278),
    (265, 279), (266, 280), (267, 282), (268, 283), (269, 284), (270, 285, 271, 286), (272, 287), (273, 288, 277, 292), (274, 289, 276,
    291), (275, 290, 281, 296), (278, 293), (279, 294), (280, 295, 282, 297), (283, 298), (284, 299), (285, 300), (286, 301),
    (287, 302), (288, 303), (289, 304), (290, 305), (291, 306), (292, 307), (293, 308), (294, 309), (295, 310), (296, 311), (297, 312),
    (298, 313), (299, 314), (300, 315, 303, 318), (301, 316, 302, 317), (304, 319, 305, 320), (306, 321, 308, 323), (307, 322, 313, 328),
    (309, 324, 310, 325), (311, 326), (312, 327), (314, 329), (315, 330), (316, 331), (319, 332), (320, 333), (321, 334), (324, 335),
    (325, 336), (326, 337), (327, 338), (328, 339), (329, 340), (330, 341, 331, 342), (332, 343, 334, 345), (333, 344, 337, 348),
    (335, 346), (336, 347, 338, 349), (339, 350), (340, 351), (341, 352), (343, 353), (344, 354), (345, 355), (346, 356), (347, 357),
    (349, 358), (350, 359), (351, 361), (352, 362, 353, 363), (354, 364, 358, 368), (355, 365, 356, 366), (357, 367, 361, 371),
    (359, 369, 360, 370), (363, 372), (366, 373), (367, 374), (368, 375), (369, 376), (370, 377), (371, 379), (372, 380, 374, 382),
    (373, 381), (375, 383), (376, 384), (377, 385, 378, 386), (379, 387), (381, 390), (382, 391), (383, 392), (384, 393), (385, 394),
    (386, 395), (387, 396), (388, 397, 392, 401), (389, 398, 390, 399), (391, 400, 396, 405), (393, 402, 394, 403), (395, 404),
    (397, 409), (398, 410), (399, 411), (400, 412), (401, 413), (402, 414), (403, 415), (404, 416), (405, 417), (406, 418, 409, 421),
    (407, 419, 410, 422), (408, 420, 412, 424), (411, 423), (413, 425), (414, 426), (415, 427, 416, 428), (417, 429), (418, 431),
    (419, 433), (420, 434), (421, 435), (422, 436), (423, 439), (424, 440), (425, 441), (426, 442), (427, 443), (429, 444),
    (430, 446, 433, 449), (431, 447, 432, 448), (434, 450, 435, 451), (436, 452, 438, 454), (437, 453, 442, 458), (439, 455, 440, 456),
    (441, 457), (443, 459, 445, 461), (444, 460), (446, 462), (447, 463), (448, 464), (449, 465), (450, 466), (451, 467), (452, 468),
    (453, 469), (454, 470), (455, 471), (456, 472), (457, 474), (458, 475), (460, 476), (461, 477), (462, 478, 463, 479), (464, 480),
    (465, 481, 469, 485), (466, 482, 468, 484), (467, 483, 473, 489), (470, 486), (471, 487), (472, 488, 474, 490), (475, 491),
    (476, 492), (477, 493), (478, 494), (479, 495), (480, 496), (481, 497), (482, 498), (483, 499), (484, 500), (485, 501), (486, 502),
    (487, 503), (488, 504), (489, 505), (490, 506), (491, 507), (492, 509), (493, 510), (494, 511, 497, 514), (495, 512, 496, 513),
    (498, 515, 499, 516), (500, 517, 502, 519), (501, 518, 507, 524), (503, 520, 504, 521), (505, 522), (506, 523), (508, 525, 510, 527),
    (509, 526), (511, 528), (512, 529), (513, 530), (514, 531), (515, 532), (516, 533), (517, 534), (518, 536), (519, 537), (520, 538),
    (521, 539), (522, 540), (523, 541), (524, 542), (525, 543), (526, 544), (527, 545), (528, 546, 529, 547), (530, 548),
    (531, 549, 536, 554), (532, 550, 534, 552), (533, 551, 540, 558), (535, 553, 543, 561), (537, 555), (538, 556), (539, 557, 541, 559),
    (542, 560), (544, 562), (545, 563), (546, 564), (548, 565), (549, 567), (550, 568), (551, 569), (552, 570), (553, 571), (554, 572),
    (555, 573), (556, 574), (557, 575), (558, 576), (559, 577), (560, 578), (561, 580), (562, 581), (563, 582), (564, 583, 568, 587),
    (565, 584, 576, 595), (566, 585, 567, 586), (569, 588, 577, 596), (570, 589, 574, 593), (571, 590, 579, 598), (572, 591, 573, 592),
    (575, 594, 581, 600), (578, 597, 580, 599), (582, 601), (583, 603), (585, 605), (586, 607), (587, 608), (588, 609), (589, 610),
    (590, 611), (591, 612), (592, 613), (593, 614), (594, 615), (595, 616), (596, 617), (597, 618), (598, 619), (599, 620), (600, 623),
    (601, 624), (602, 625, 603, 626), (604, 627, 609, 632), (605, 628, 606, 629), (607, 630, 610, 633), (608, 631, 615, 638),
    (611, 634, 612, 635), (613, 636), (614, 637), (616, 639), (617, 640), (618, 641), (619, 642, 621, 644), (620, 643, 622, 645),
    (623, 646), (624, 647), (625, 648), (626, 649), (627, 650), (628, 651), (629, 652), (630, 653), (631, 654), (632, 655), (633, 656),
    (634, 657), (635, 658), (636, 659), (637, 660), (638, 661), (639, 662), (640, 663), (641, 664), (642, 665), (643, 666), (644, 667),
    (645, 668), (646, 669), (647, 670)];

open_edges = getindex.(filter(d->d[3], dims), 1)
size_dict = Dict([i=>d for (i,d,b) in dims])
code = EinCode((edges...,), (open_edges...,))
optcode=optimize_greedy(code, size_dict, nrepeat=10);
OMEinsum.timespace_complexity(optcode, size_dict)